<Window
    x:Class="boilersGraphics.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="clr-namespace:boilersGraphics.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helper="clr-namespace:boilersGraphics.Helpers"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:nlog="clr-namespace:NLog;assembly=NLog"
    xmlns:prism="http://prismlibrary.com/"
    xmlns:usercontrol="clr-namespace:boilersGraphics.UserControls"
    x:Name="MainWindowInstance"
    Title="{Binding Title.Value}"
    prism:ViewModelLocator.AutoWireViewModel="True"
    SnapsToDevicePixels="True"
    WindowStyle="None"
    mc:Ignorable="d">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/boilersGraphics;component/Resources/Theme.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converter:StrokeColorConverter x:Key="StrokeColorConverter" />
            <converter:WindowStateToVisibilityConverter x:Key="WindowStateToVisibilityConverter" />
            <converter:LogLevelToBoolConverter x:Key="LogLevelToBool" />
            <converter:PreviewConverter x:Key="PreviewConverter" />
            <converter:FilenameWithFileSizeConverter x:Key="FilenameWithFileSize" />
            <converter:CultureToBool x:Key="CultureToBool" />
        </ResourceDictionary>
    </Window.Resources>
    <Window.CommandBindings>
        <CommandBinding
            CanExecute="CommandBinding_CanExecute_Close"
            Command="{x:Static SystemCommands.CloseWindowCommand}"
            Executed="CommandBinding_Executed_Close" />
        <CommandBinding
            CanExecute="CommandBinding_CanExecute_Maximize"
            Command="{x:Static SystemCommands.MaximizeWindowCommand}"
            Executed="CommandBinding_Executed_Maximize" />
        <CommandBinding
            CanExecute="CommandBinding_CanExecute_Minimize"
            Command="{x:Static SystemCommands.MinimizeWindowCommand}"
            Executed="CommandBinding_Executed_Minimize" />
        <CommandBinding
            CanExecute="CommandBinding_CanExecute_Restore"
            Command="{x:Static SystemCommands.RestoreWindowCommand}"
            Executed="CommandBinding_Executed_Restore" />
    </Window.CommandBindings>
    <Window.InputBindings>
        <KeyBinding Key="Del" Command="{Binding DeleteSelectedItemsCommand}" />
        <KeyBinding
            Key="A"
            Command="{Binding DiagramViewModel.SelectAllCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="D"
            Command="{Binding DiagramViewModel.DuplicateCommand}"
            Modifiers="Ctrl" />
        <KeyBinding Command="{Binding ExitApplicationCommand}" Gesture="Alt+F4" />
        <KeyBinding
            Key="S"
            Command="{Binding DiagramViewModel.SaveCommand}"
            Modifiers="Ctrl+Shift" />
        <KeyBinding
            Key="S"
            Command="{Binding DiagramViewModel.OverwriteCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="E"
            Command="{Binding DiagramViewModel.ExportCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="X"
            Command="{Binding DiagramViewModel.CutCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="C"
            Command="{Binding DiagramViewModel.CopyCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="V"
            Command="{Binding DiagramViewModel.PasteCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="Z"
            Command="{Binding DiagramViewModel.UndoCommand}"
            Modifiers="Ctrl" />
        <KeyBinding
            Key="Y"
            Command="{Binding DiagramViewModel.RedoCommand}"
            Modifiers="Ctrl" />
    </Window.InputBindings>
    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="{x:Static SystemParameters.CaptionHeight}"
            ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}"
            UseAeroCaptionButtons="True" />
    </WindowChrome.WindowChrome>
    <Window.Template>
        <ControlTemplate TargetType="Window">
            <Border
                x:Name="border"
                Background="{StaticResource ControlDarkerBackground}"
                BorderBrush="{StaticResource ControlDarkerBorderBrush}"
                BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <DockPanel Grid.Row="0">
                        <DockPanel.Resources>
                            <!--<SolidColorBrush x:Key="Menu.Static.Background" Color="#FFF0F0F0"/>
                            <SolidColorBrush x:Key="Menu.Static.Border" Color="#FF999999"/>
                            <SolidColorBrush x:Key="Menu.Static.Foreground" Color="#FF212121"/>
                            <SolidColorBrush x:Key="Menu.Static.Separator" Color="#FFD7D7D7"/>-->
                            <!--<SolidColorBrush x:Key="Menu.Static.Background" Color="#FFF0F0F0"/>-->
                            <!--<SolidColorBrush x:Key="Menu.Static.Border" Color="#FF999999"/>-->

                            <!--<StaticResourceExtension ResourceKey="ControlDarkerBackground" x:Key="Menu.Static.Background" />-->
                            <!--<StaticResourceExtension ResourceKey="ControlDarkerBorderBrush" x:Key="Menu.Static.Border" />
                            <SolidColorBrush x:Key="Menu.Static.Foreground" Color="White"/>
                            <SolidColorBrush x:Key="Menu.Static.Separator" Color="#FFD7D7D7"/>-->

                            <SolidColorBrush x:Key="Menu.Disabled.Foreground" Color="#FF707070" />
                            <SolidColorBrush x:Key="MenuItem.Selected.Background" Color="#3D26A0DA" />
                            <SolidColorBrush x:Key="MenuItem.Selected.Border" Color="#FF26A0DA" />
                            <SolidColorBrush x:Key="MenuItem.Highlight.Background" Color="#3D26A0DA" />
                            <SolidColorBrush x:Key="MenuItem.Highlight.Border" Color="#FF26A0DA" />
                            <SolidColorBrush x:Key="MenuItem.Highlight.Disabled.Background" Color="#0A000000" />
                            <SolidColorBrush x:Key="MenuItem.Highlight.Disabled.Border" Color="#21000000" />
                            <MenuScrollingVisibilityConverter x:Key="MenuScrollingVisibilityConverter" />
                            <Geometry x:Key="DownArrow">M 0,0 L 3.5,4 L 7,0 Z</Geometry>
                            <Geometry x:Key="UpArrow">M 0,4 L 3.5,0 L 7,4 Z</Geometry>
                            <Geometry x:Key="RightArrow">M 0,0 L 4,3.5 L 0,7 Z</Geometry>
                            <Geometry x:Key="Checkmark">F1 M 10.0,1.2 L 4.7,9.1 L 4.5,9.1 L 0,5.2 L 1.3,3.5 L 4.3,6.1L 8.3,0 L 10.0,1.2 Z</Geometry>
                            <Style
                                x:Key="MenuScrollButton"
                                BasedOn="{x:Null}"
                                TargetType="{x:Type RepeatButton}">
                                <Setter Property="ClickMode" Value="Hover" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type RepeatButton}">
                                            <Border
                                                x:Name="templateRoot"
                                                Background="Transparent"
                                                BorderBrush="Transparent"
                                                BorderThickness="1"
                                                SnapsToDevicePixels="true">
                                                <ContentPresenter
                                                    Margin="6"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                            <Style
                                x:Key="{ComponentResourceKey ResourceId=MenuScrollViewer,
                                                             TypeInTargetAssembly={x:Type FrameworkElement}}"
                                BasedOn="{x:Null}"
                                TargetType="{x:Type ScrollViewer}">
                                <Setter Property="HorizontalScrollBarVisibility" Value="Hidden" />
                                <Setter Property="VerticalScrollBarVisibility" Value="Auto" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type ScrollViewer}">
                                            <Grid SnapsToDevicePixels="true">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="*" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <Border Grid.Row="1" Grid.Column="0">
                                                    <ScrollContentPresenter
                                                        x:Name="ScrollViewer_ScrollContentPresenter"
                                                        Margin="{TemplateBinding Padding}"
                                                        CanContentScroll="{TemplateBinding CanContentScroll}" />
                                                </Border>
                                                <RepeatButton
                                                    Grid.Row="0"
                                                    Grid.Column="0"
                                                    Command="{x:Static ScrollBar.LineUpCommand}"
                                                    CommandTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}"
                                                    Focusable="false"
                                                    Style="{StaticResource MenuScrollButton}">
                                                    <RepeatButton.Visibility>
                                                        <MultiBinding
                                                            Converter="{StaticResource MenuScrollingVisibilityConverter}"
                                                            ConverterParameter="0"
                                                            FallbackValue="Visibility.Collapsed">
                                                            <Binding Path="ComputedVerticalScrollBarVisibility"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                            <Binding Path="VerticalOffset"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                            <Binding Path="ExtentHeight"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                            <Binding Path="ViewportHeight"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                        </MultiBinding>
                                                    </RepeatButton.Visibility>
                                                    <Path Data="{StaticResource UpArrow}"
                                                          Fill="{StaticResource ControlDefaultForeground}" />
                                                </RepeatButton>
                                                <RepeatButton
                                                    Grid.Row="2"
                                                    Grid.Column="0"
                                                    Command="{x:Static ScrollBar.LineDownCommand}"
                                                    CommandTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}"
                                                    Focusable="false"
                                                    Style="{StaticResource MenuScrollButton}">
                                                    <RepeatButton.Visibility>
                                                        <MultiBinding
                                                            Converter="{StaticResource MenuScrollingVisibilityConverter}"
                                                            ConverterParameter="100"
                                                            FallbackValue="Visibility.Collapsed">
                                                            <Binding Path="ComputedVerticalScrollBarVisibility"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                            <Binding Path="VerticalOffset"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                            <Binding Path="ExtentHeight"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                            <Binding Path="ViewportHeight"
                                                                     RelativeSource="{RelativeSource TemplatedParent}" />
                                                        </MultiBinding>
                                                    </RepeatButton.Visibility>
                                                    <Path Data="{StaticResource DownArrow}"
                                                          Fill="{StaticResource ControlDefaultForeground}" />
                                                </RepeatButton>
                                            </Grid>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                            <ControlTemplate
                                x:Key="{ComponentResourceKey ResourceId=TopLevelItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}"
                                TargetType="{x:Type MenuItem}">
                                <Border
                                    x:Name="templateRoot"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="true">
                                    <Grid VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter
                                            x:Name="Icon"
                                            Width="16"
                                            Height="16"
                                            Margin="3"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            ContentSource="Icon"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        <Path
                                            x:Name="GlyphPanel"
                                            Margin="3"
                                            VerticalAlignment="Center"
                                            Data="{StaticResource Checkmark}"
                                            Fill="{StaticResource ControlDefaultForeground}"
                                            FlowDirection="LeftToRight"
                                            Visibility="Collapsed" />
                                        <ContentPresenter
                                            x:Name="MenuItem_Header_ContentPresenter"
                                            Grid.Column="1"
                                            Margin="{TemplateBinding Padding}"
                                            ContentSource="Header"
                                            RecognizesAccessKey="True"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                    </Grid>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="Icon" Value="{x:Null}">
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="true">
                                        <Setter TargetName="GlyphPanel" Property="Visibility" Value="Visible" />
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsHighlighted" Value="True">
                                        <Setter TargetName="templateRoot" Property="Background"
                                                Value="{StaticResource MenuItem.Highlight.Background}" />
                                        <Setter TargetName="templateRoot" Property="BorderBrush"
                                                Value="{StaticResource MenuItem.Highlight.Border}" />
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="templateRoot" Property="TextElement.Foreground"
                                                Value="{StaticResource ControlDefaultForeground}" />
                                        <Setter TargetName="GlyphPanel" Property="Fill"
                                                Value="{StaticResource ControlDisabledBackground}" />
                                    </Trigger>
                                    <MultiTrigger>
                                        <MultiTrigger.Conditions>
                                            <Condition Property="IsHighlighted" Value="True" />
                                            <Condition Property="IsEnabled" Value="False" />
                                        </MultiTrigger.Conditions>
                                        <Setter TargetName="templateRoot" Property="Background"
                                                Value="{StaticResource MenuItem.Highlight.Disabled.Background}" />
                                        <Setter TargetName="templateRoot" Property="BorderBrush"
                                                Value="{StaticResource MenuItem.Highlight.Disabled.Border}" />
                                    </MultiTrigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                            <ControlTemplate
                                x:Key="{ComponentResourceKey ResourceId=TopLevelHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}"
                                TargetType="{x:Type MenuItem}">
                                <Border
                                    x:Name="templateRoot"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="true">
                                    <Grid VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter
                                            x:Name="Icon"
                                            Width="16"
                                            Height="16"
                                            Margin="3"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            ContentSource="Icon"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        <Path
                                            x:Name="GlyphPanel"
                                            Margin="3"
                                            VerticalAlignment="Center"
                                            Data="{StaticResource Checkmark}"
                                            Fill="{TemplateBinding Foreground}"
                                            FlowDirection="LeftToRight"
                                            Visibility="Collapsed" />
                                        <ContentPresenter
                                            Grid.Column="1"
                                            Margin="{TemplateBinding Padding}"
                                            ContentSource="Header"
                                            RecognizesAccessKey="True"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        <Popup
                                            x:Name="PART_Popup"
                                            AllowsTransparency="true"
                                            Focusable="false"
                                            IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                            Placement="Bottom"
                                            PlacementTarget="{Binding ElementName=templateRoot}"
                                            PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}">
                                            <Border x:Name="SubMenuBorder"
                                                    Background="{StaticResource ControlDarkerBackground}">
                                                <ScrollViewer x:Name="SubMenuScrollViewer"
                                                              Style="{DynamicResource {ComponentResourceKey ResourceId=MenuScrollViewer, TypeInTargetAssembly={x:Type FrameworkElement}}}">
                                                    <Grid RenderOptions.ClearTypeHint="Enabled">
                                                        <Canvas
                                                            Width="0"
                                                            Height="0"
                                                            HorizontalAlignment="Left"
                                                            VerticalAlignment="Top">
                                                            <Rectangle
                                                                x:Name="OpaqueRect"
                                                                Width="{Binding ActualWidth, ElementName=SubMenuBorder}"
                                                                Height="{Binding ActualHeight, ElementName=SubMenuBorder}"
                                                                Fill="{Binding Background, ElementName=SubMenuBorder}" />
                                                        </Canvas>
                                                        <Rectangle
                                                            Width="1"
                                                            Margin="29,2,0,2"
                                                            HorizontalAlignment="Left"
                                                            Fill="{StaticResource ControlDarkerBackground}" />
                                                        <ItemsPresenter
                                                            x:Name="ItemsPresenter"
                                                            Grid.IsSharedSizeScope="true"
                                                            KeyboardNavigation.DirectionalNavigation="Cycle"
                                                            KeyboardNavigation.TabNavigation="Cycle"
                                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                    </Grid>
                                                </ScrollViewer>
                                            </Border>
                                        </Popup>
                                    </Grid>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSuspendingPopupAnimation" Value="true">
                                        <Setter TargetName="PART_Popup" Property="PopupAnimation" Value="None" />
                                    </Trigger>
                                    <Trigger Property="Icon" Value="{x:Null}">
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="true">
                                        <Setter TargetName="GlyphPanel" Property="Visibility" Value="Visible" />
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsHighlighted" Value="True">
                                        <Setter TargetName="templateRoot" Property="Background"
                                                Value="{StaticResource MenuItem.Highlight.Background}" />
                                        <Setter TargetName="templateRoot" Property="BorderBrush"
                                                Value="{StaticResource MenuItem.Highlight.Border}" />
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="templateRoot" Property="TextElement.Foreground"
                                                Value="{StaticResource Menu.Disabled.Foreground}" />
                                        <Setter TargetName="GlyphPanel" Property="Fill"
                                                Value="{StaticResource Menu.Disabled.Foreground}" />
                                    </Trigger>
                                    <Trigger SourceName="SubMenuScrollViewer" Property="ScrollViewer.CanContentScroll"
                                             Value="false">
                                        <Setter TargetName="OpaqueRect" Property="Canvas.Top"
                                                Value="{Binding VerticalOffset, ElementName=SubMenuScrollViewer}" />
                                        <Setter TargetName="OpaqueRect" Property="Canvas.Left"
                                                Value="{Binding HorizontalOffset, ElementName=SubMenuScrollViewer}" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                            <ControlTemplate
                                x:Key="{ComponentResourceKey ResourceId=SubmenuItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}"
                                TargetType="{x:Type MenuItem}">
                                <Border
                                    x:Name="templateRoot"
                                    Height="22"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="true">
                                    <Grid Margin="-1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition
                                                Width="Auto"
                                                MinWidth="22"
                                                SharedSizeGroup="MenuItemIconColumnGroup" />
                                            <ColumnDefinition Width="13" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="30" />
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemIGTColumnGroup" />
                                            <ColumnDefinition Width="20" />
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter
                                            x:Name="Icon"
                                            Width="16"
                                            Height="16"
                                            Margin="3"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            ContentSource="Icon"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        <Border
                                            x:Name="GlyphPanel"
                                            Width="22"
                                            Height="22"
                                            Margin="-1,0,0,0"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Background="{StaticResource MenuItem.Selected.Background}"
                                            BorderBrush="{StaticResource MenuItem.Selected.Border}"
                                            BorderThickness="1"
                                            ClipToBounds="False"
                                            Visibility="Hidden">
                                            <Path
                                                x:Name="Glyph"
                                                Width="10"
                                                Height="11"
                                                Data="{StaticResource Checkmark}"
                                                Fill="{StaticResource ControlDefaultForeground}"
                                                FlowDirection="LeftToRight" />
                                        </Border>
                                        <ContentPresenter
                                            x:Name="menuHeaderContainer"
                                            Grid.Column="2"
                                            Margin="{TemplateBinding Padding}"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            ContentSource="Header"
                                            RecognizesAccessKey="True"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        <TextBlock
                                            x:Name="menuGestureText"
                                            Grid.Column="4"
                                            Margin="{TemplateBinding Padding}"
                                            VerticalAlignment="Center"
                                            Opacity="0.7"
                                            Text="{TemplateBinding InputGestureText}" />
                                    </Grid>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="Icon" Value="{x:Null}">
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="GlyphPanel" Property="Visibility" Value="Visible" />
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsHighlighted" Value="True">
                                        <Setter TargetName="templateRoot" Property="Background"
                                                Value="{StaticResource MenuItem.Highlight.Background}" />
                                        <Setter TargetName="templateRoot" Property="BorderBrush"
                                                Value="{StaticResource MenuItem.Highlight.Border}" />
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="templateRoot" Property="TextElement.Foreground"
                                                Value="{StaticResource Menu.Disabled.Foreground}" />
                                        <Setter TargetName="Glyph" Property="Fill"
                                                Value="{StaticResource Menu.Disabled.Foreground}" />
                                    </Trigger>
                                    <MultiTrigger>
                                        <MultiTrigger.Conditions>
                                            <Condition Property="IsHighlighted" Value="True" />
                                            <Condition Property="IsEnabled" Value="False" />
                                        </MultiTrigger.Conditions>
                                        <Setter TargetName="templateRoot" Property="Background"
                                                Value="{StaticResource MenuItem.Highlight.Disabled.Background}" />
                                        <Setter TargetName="templateRoot" Property="BorderBrush"
                                                Value="{StaticResource MenuItem.Highlight.Disabled.Border}" />
                                    </MultiTrigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                            <ControlTemplate
                                x:Key="{ComponentResourceKey ResourceId=SubmenuHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}"
                                TargetType="{x:Type MenuItem}">
                                <Border
                                    x:Name="templateRoot"
                                    Height="22"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    SnapsToDevicePixels="true">
                                    <Grid Margin="-1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition
                                                Width="Auto"
                                                MinWidth="22"
                                                SharedSizeGroup="MenuItemIconColumnGroup" />
                                            <ColumnDefinition Width="13" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="30" />
                                            <ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemIGTColumnGroup" />
                                            <ColumnDefinition Width="20" />
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter
                                            x:Name="Icon"
                                            Width="16"
                                            Height="16"
                                            Margin="3"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            ContentSource="Icon"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        <Border
                                            x:Name="GlyphPanel"
                                            Width="22"
                                            Height="22"
                                            Margin="-1,0,0,0"
                                            VerticalAlignment="Center"
                                            Background="{StaticResource MenuItem.Highlight.Background}"
                                            BorderBrush="{StaticResource MenuItem.Highlight.Border}"
                                            BorderThickness="1"
                                            Visibility="Hidden">
                                            <Path
                                                x:Name="Glyph"
                                                Width="9"
                                                Height="11"
                                                Data="{DynamicResource Checkmark}"
                                                Fill="{StaticResource ControlDefaultForeground}"
                                                FlowDirection="LeftToRight" />
                                        </Border>
                                        <ContentPresenter
                                            Grid.Column="2"
                                            Margin="{TemplateBinding Padding}"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            ContentSource="Header"
                                            RecognizesAccessKey="True"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        <TextBlock
                                            Grid.Column="4"
                                            Margin="{TemplateBinding Padding}"
                                            VerticalAlignment="Center"
                                            Opacity="0.7"
                                            Text="{TemplateBinding InputGestureText}" />
                                        <Path
                                            x:Name="RightArrow"
                                            Grid.Column="5"
                                            Margin="10,0,0,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center"
                                            Data="{StaticResource RightArrow}"
                                            Fill="{StaticResource ControlDefaultForeground}" />
                                        <Popup
                                            x:Name="PART_Popup"
                                            AllowsTransparency="true"
                                            Focusable="false"
                                            HorizontalOffset="-2"
                                            IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                            Placement="Right"
                                            PopupAnimation="{DynamicResource {x:Static SystemParameters.MenuPopupAnimationKey}}"
                                            VerticalOffset="-3">
                                            <Border x:Name="SubMenuBorder"
                                                    Background="{StaticResource ControlDarkerBackground}">
                                                <ScrollViewer x:Name="SubMenuScrollViewer"
                                                              Style="{DynamicResource {ComponentResourceKey ResourceId=MenuScrollViewer, TypeInTargetAssembly={x:Type FrameworkElement}}}">
                                                    <Grid RenderOptions.ClearTypeHint="Enabled">
                                                        <Canvas
                                                            Width="0"
                                                            Height="0"
                                                            HorizontalAlignment="Left"
                                                            VerticalAlignment="Top">
                                                            <Rectangle
                                                                x:Name="OpaqueRect"
                                                                Width="{Binding ActualWidth, ElementName=SubMenuBorder}"
                                                                Height="{Binding ActualHeight, ElementName=SubMenuBorder}"
                                                                Fill="{Binding Background, ElementName=SubMenuBorder}" />
                                                        </Canvas>
                                                        <Rectangle
                                                            Width="1"
                                                            Margin="29,2,0,2"
                                                            HorizontalAlignment="Left"
                                                            Fill="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}" />
                                                        <ItemsPresenter
                                                            x:Name="ItemsPresenter"
                                                            Grid.IsSharedSizeScope="true"
                                                            KeyboardNavigation.DirectionalNavigation="Cycle"
                                                            KeyboardNavigation.TabNavigation="Cycle"
                                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                    </Grid>
                                                </ScrollViewer>
                                            </Border>
                                        </Popup>
                                    </Grid>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSuspendingPopupAnimation" Value="true">
                                        <Setter TargetName="PART_Popup" Property="PopupAnimation" Value="None" />
                                    </Trigger>
                                    <Trigger Property="Icon" Value="{x:Null}">
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="GlyphPanel" Property="Visibility" Value="Visible" />
                                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                                    </Trigger>
                                    <Trigger Property="IsHighlighted" Value="True">
                                        <Setter TargetName="templateRoot" Property="Background" Value="Transparent" />
                                        <Setter TargetName="templateRoot" Property="BorderBrush"
                                                Value="{StaticResource MenuItem.Highlight.Border}" />
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="templateRoot" Property="TextElement.Foreground"
                                                Value="{StaticResource Menu.Disabled.Foreground}" />
                                        <Setter TargetName="Glyph" Property="Fill"
                                                Value="{StaticResource Menu.Disabled.Foreground}" />
                                        <Setter TargetName="RightArrow" Property="Fill"
                                                Value="{StaticResource Menu.Disabled.Foreground}" />
                                    </Trigger>
                                    <Trigger SourceName="SubMenuScrollViewer" Property="ScrollViewer.CanContentScroll"
                                             Value="false">
                                        <Setter TargetName="OpaqueRect" Property="Canvas.Top"
                                                Value="{Binding VerticalOffset, ElementName=SubMenuScrollViewer}" />
                                        <Setter TargetName="OpaqueRect" Property="Canvas.Left"
                                                Value="{Binding HorizontalOffset, ElementName=SubMenuScrollViewer}" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                            <Style TargetType="{x:Type MenuItem}">
                                <Setter Property="HorizontalContentAlignment"
                                        Value="{Binding HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />
                                <Setter Property="VerticalContentAlignment"
                                        Value="{Binding VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="BorderBrush" Value="Transparent" />
                                <Setter Property="BorderThickness" Value="1" />
                                <Setter Property="Height" Value="26" />
                                <Setter Property="ScrollViewer.PanningMode" Value="Both" />
                                <Setter Property="Stylus.IsFlicksEnabled" Value="False" />
                                <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
                                <Setter Property="Template"
                                        Value="{DynamicResource {ComponentResourceKey ResourceId=SubmenuItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}" />
                                <Style.Triggers>
                                    <Trigger Property="Role" Value="TopLevelHeader">
                                        <Setter Property="Background" Value="Transparent" />
                                        <Setter Property="BorderBrush" Value="Transparent" />
                                        <Setter Property="Foreground" Value="{StaticResource ControlDefaultForeground}" />
                                        <Setter Property="Template"
                                                Value="{DynamicResource {ComponentResourceKey ResourceId=TopLevelHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}" />
                                        <Setter Property="Padding" Value="6,0" />
                                    </Trigger>
                                    <Trigger Property="Role" Value="TopLevelItem">
                                        <Setter Property="Background" Value="{StaticResource ControlDarkerBackground}" />
                                        <Setter Property="BorderBrush"
                                                Value="{StaticResource ControlDarkerBorderBrush}" />
                                        <Setter Property="Foreground" Value="{StaticResource ControlDefaultForeground}" />
                                        <Setter Property="Template"
                                                Value="{DynamicResource {ComponentResourceKey ResourceId=TopLevelItemTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}" />
                                        <Setter Property="Padding" Value="6,0" />
                                    </Trigger>
                                    <Trigger Property="Role" Value="SubmenuHeader">
                                        <Setter Property="Template"
                                                Value="{DynamicResource {ComponentResourceKey ResourceId=SubmenuHeaderTemplateKey, TypeInTargetAssembly={x:Type MenuItem}}}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                            <!--<Style TargetType="MenuItem">
                                <Setter Property="BorderThickness" Value="0" />
                                <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
                                <Setter Property="Background" Value="{StaticResource ControlDarkerBackground}" />
                                <Setter Property="BorderBrush" Value="{StaticResource ControlDarkerBorderBrush}" />
                            </Style>
                            <Style x:Key="{x:Static MenuItem.SeparatorStyleKey}" TargetType="Separator">
                                <Setter Property="Background" Value="{StaticResource ControlDarkerBackground}" />
                                <Setter Property="BorderBrush" Value="{StaticResource ControlDarkerBorderBrush}" />
                            </Style>-->
                        </DockPanel.Resources>
                        <Menu DockPanel.Dock="Left">
                            <MenuItem
                                Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_File, Mode=OneWay}">
                                <MenuItem
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Open, Mode=OneWay}">
                                    <MenuItem Command="{Binding DiagramViewModel.LoadCommand}"
                                              Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_SpecifyFile, Mode=OneWay}" />
                                    <MenuItem
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_SpecifyFileAutoSaved, Mode=OneWay}"
                                        ItemsSource="{Binding DiagramViewModel.AutoSaveFiles}">
                                        <MenuItem.ItemContainerStyle>
                                            <Style TargetType="MenuItem">
                                                <Setter Property="Header"
                                                        Value="{Binding Converter={StaticResource FilenameWithFileSize}}" />
                                                <Setter Property="Command"
                                                        Value="{Binding Path=DataContext.DiagramViewModel.LoadFileCommand, ElementName=MainWindowInstance}" />
                                                <Setter Property="CommandParameter" Value="{Binding}" />
                                                <Setter Property="ToolTip">
                                                    <Setter.Value>
                                                        <ToolTip
                                                            Width="Auto"
                                                            Height="Auto"
                                                            Content="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}, Converter={StaticResource PreviewConverter}}"
                                                            Placement="Right"
                                                            ToolTipService.ShowDuration="6000" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </MenuItem.ItemContainerStyle>
                                    </MenuItem>
                                </MenuItem>
                                <MenuItem
                                    Command="{Binding DiagramViewModel.SaveCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_SaveAs, Mode=OneWay}"
                                    InputGestureText="Ctrl+Shift+S" />
                                <MenuItem
                                    Command="{Binding DiagramViewModel.OverwriteCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Overwrite, Mode=OneWay}"
                                    InputGestureText="Ctrl+S" />
                                <MenuItem
                                    Command="{Binding DiagramViewModel.ExportCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Export, Mode=OneWay}"
                                    InputGestureText="Ctrl+E" />
                                <MenuItem
                                    Command="{Binding ExitApplicationCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_ExitApplication, Mode=OneWay}"
                                    InputGestureText="Alt+F4" />
                            </MenuItem>
                            <MenuItem
                                Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Edit, Mode=OneWay}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="SubmenuOpened">
                                        <helper:EventToCommand
                                            Command="{Binding DiagramViewModel.EditMenuOpenedCommand}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <MenuItem
                                    Command="{Binding DiagramViewModel.CutCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Cut, Mode=OneWay}"
                                    InputGestureText="Ctrl+X" />
                                <MenuItem
                                    Command="{Binding DiagramViewModel.CopyCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Copy, Mode=OneWay}"
                                    InputGestureText="Ctrl+C" />
                                <MenuItem
                                    Command="{Binding DiagramViewModel.PasteCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Paste, Mode=OneWay}"
                                    InputGestureText="Ctrl+V" />
                                <MenuItem
                                    Command="{Binding DiagramViewModel.UndoCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Undo, Mode=OneWay}"
                                    InputGestureText="Ctrl+Z" />
                                <MenuItem
                                    Command="{Binding DiagramViewModel.RedoCommand}"
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Redo, Mode=OneWay}"
                                    InputGestureText="Ctrl+Y" />
                            </MenuItem>
                            <MenuItem
                                Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Canvas, Mode=OneWay}">
                                <MenuItem Command="{Binding DiagramViewModel.ClipCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Clip, Mode=OneWay}" />
                                <MenuItem Command="{Binding DiagramViewModel.FitCanvasCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_FitCanvas, Mode=OneWay}" />
                                <MenuItem Command="{Binding DiagramViewModel.CopyCanvasToClipboardCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_CopyCanvasToClipboard, Mode=OneWay}" />
                                <MenuItem Command="{Binding DiagramViewModel.ClearCanvasCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_ClearCanvas, Mode=OneWay}" />
                                <MenuItem Command="{Binding DiagramViewModel.SettingCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Preference, Mode=OneWay}" />
                            </MenuItem>
                            <MenuItem
                                Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_View, Mode=OneWay}">
                                <MenuItem
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Window, Mode=OneWay}">
                                    <MenuItem
                                        Command="{Binding SwitchMiniMapCommand}"
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_MiniMap, Mode=OneWay}"
                                        IsChecked="{Binding DiagramViewModel.EnableMiniMap.Value, Mode=TwoWay}" />
                                    <MenuItem
                                        Command="{Binding SwitchCombineCommand}"
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Combine, Mode=OneWay}"
                                        IsChecked="{Binding DiagramViewModel.EnableCombine.Value, Mode=TwoWay}" />
                                    <MenuItem
                                        Command="{Binding SwitchLayersCommand}"
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Layering, Mode=OneWay}"
                                        IsChecked="{Binding DiagramViewModel.EnableLayers.Value, Mode=TwoWay}" />
                                    <MenuItem
                                        Command="{Binding SwitchWorkHistoryCommand}"
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_WorkHistory, Mode=OneWay}"
                                        IsChecked="{Binding DiagramViewModel.EnableWorkHistory.Value, Mode=TwoWay}" />
                                    <MenuItem
                                        Command="{Binding SwitchBrushThicknessCommand}"
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_BrushThickness, Mode=OneWay}"
                                        IsChecked="{Binding DiagramViewModel.EnableBrushThickness.Value, Mode=TwoWay}" />
                                </MenuItem>
                            </MenuItem>
                            <MenuItem
                                Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Help, Mode=OneWay}">
                                <MenuItem
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Log, Mode=OneWay}">
                                    <MenuItem
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel, Mode=OneWay}">
                                        <MenuItem
                                            Command="{Binding SetLogLevelCommand}"
                                            CommandParameter="{x:Static nlog:LogLevel.Trace}"
                                            Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel_Trace, Mode=OneWay}"
                                            IsChecked="{Binding LogLevel.Value, Converter={StaticResource LogLevelToBool}, ConverterParameter=Trace}" />
                                        <MenuItem
                                            Command="{Binding SetLogLevelCommand}"
                                            CommandParameter="{x:Static nlog:LogLevel.Debug}"
                                            Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel_Debug, Mode=OneWay}"
                                            IsChecked="{Binding LogLevel.Value, Converter={StaticResource LogLevelToBool}, ConverterParameter=Debug}" />
                                        <MenuItem
                                            Command="{Binding SetLogLevelCommand}"
                                            CommandParameter="{x:Static nlog:LogLevel.Info}"
                                            Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel_Info, Mode=OneWay}"
                                            IsChecked="{Binding LogLevel.Value, Converter={StaticResource LogLevelToBool}, ConverterParameter=Info}" />
                                        <MenuItem
                                            Command="{Binding SetLogLevelCommand}"
                                            CommandParameter="{x:Static nlog:LogLevel.Warn}"
                                            Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel_Warn, Mode=OneWay}"
                                            IsChecked="{Binding LogLevel.Value, Converter={StaticResource LogLevelToBool}, ConverterParameter=Warn}" />
                                        <MenuItem
                                            Command="{Binding SetLogLevelCommand}"
                                            CommandParameter="{x:Static nlog:LogLevel.Error}"
                                            Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel_Error, Mode=OneWay}"
                                            IsChecked="{Binding LogLevel.Value, Converter={StaticResource LogLevelToBool}, ConverterParameter=Error}" />
                                        <MenuItem
                                            Command="{Binding SetLogLevelCommand}"
                                            CommandParameter="{x:Static nlog:LogLevel.Fatal}"
                                            Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel_Fatal, Mode=OneWay}"
                                            IsChecked="{Binding LogLevel.Value, Converter={StaticResource LogLevelToBool}, ConverterParameter=Fatal}" />
                                        <MenuItem
                                            Command="{Binding SetLogLevelCommand}"
                                            CommandParameter="{x:Static nlog:LogLevel.Off}"
                                            Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_LogLevel_Off, Mode=OneWay}"
                                            IsChecked="{Binding LogLevel.Value, Converter={StaticResource LogLevelToBool}, ConverterParameter=Off}" />
                                    </MenuItem>
                                    <MenuItem Command="{Binding ShowLogCommand}"
                                              Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_ShowLog, Mode=OneWay}" />
                                </MenuItem>
                                <MenuItem
                                    Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Language, Mode=OneWay}">
                                    <MenuItem
                                        Command="{Binding SwitchLanguageCommand}"
                                        CommandParameter="en-US"
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_en_US, Mode=OneWay}"
                                        IsChecked="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Culture, Mode=OneWay, Converter={StaticResource CultureToBool}, ConverterParameter=en-US}" />
                                    <MenuItem
                                        Command="{Binding SwitchLanguageCommand}"
                                        CommandParameter="ja-JP"
                                        Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_ja_JP, Mode=OneWay}"
                                        IsChecked="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Culture, Mode=OneWay, Converter={StaticResource CultureToBool}, ConverterParameter=ja-JP}" />
                                </MenuItem>
                                <MenuItem Command="{Binding PostNewIssueCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_PostNewIssue, Mode=OneWay}" />
                                <MenuItem Command="{Binding ShowPrivacyPolicyCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_ShowPrivacyPolicy, Mode=OneWay}" />
                                <MenuItem Command="{Binding ShowStatisticsCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Statistics, Mode=OneWay}" />
                                <MenuItem Command="{Binding ShowVersionCommand}"
                                          Header="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.MenuItem_Version, Mode=OneWay}" />
                            </MenuItem>
                        </Menu>
                        <StackPanel
                            HorizontalAlignment="Right"
                            VerticalAlignment="Stretch"
                            DockPanel.Dock="Right"
                            Orientation="Horizontal">
                            <Button
                                Command="{x:Static SystemCommands.MinimizeWindowCommand}"
                                Content="0"
                                Foreground="Gray"
                                Style="{DynamicResource CaptionButtonStyleKey}">
                                <Button.ToolTip>
                                    <ToolTip FontFamily="メイリオ">
                                        <TextBlock
                                            Text="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Button_MinimizeWindow, Mode=OneWay}" />
                                    </ToolTip>
                                </Button.ToolTip>
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border
                                            x:Name="Border"
                                            Background="{StaticResource ControlDarkerBackground}"
                                            BorderThickness="1"
                                            CornerRadius="2"
                                            TextBlock.Foreground="{TemplateBinding Foreground}">
                                            <Border.BorderBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <LinearGradientBrush.GradientStops>
                                                        <GradientStopCollection>
                                                            <GradientStop Offset="0.0"
                                                                          Color="{StaticResource ControlBrightColor}" />
                                                            <GradientStop Offset="1.0"
                                                                          Color="{StaticResource ControlDarkerColor}" />
                                                        </GradientStopCollection>
                                                    </LinearGradientBrush.GradientStops>
                                                </LinearGradientBrush>
                                            </Border.BorderBrush>
                                            <ContentPresenter
                                                Margin="2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                RecognizesAccessKey="True" />
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualStateGroup.Transitions>
                                                        <VisualTransition GeneratedDuration="0:0:0.5" />
                                                        <VisualTransition GeneratedDuration="0" To="Pressed" />
                                                    </VisualStateGroup.Transitions>
                                                    <VisualState x:Name="Normal" />
                                                    <VisualState x:Name="MouseOver">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="Orange" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Pressed">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="DarkOrange" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[0].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderLightColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Disabled">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledControlDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledForegroundColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateManager.VisualStateGroups>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <Button
                                x:Name="MaximizeButton"
                                Command="{x:Static SystemCommands.MaximizeWindowCommand}"
                                Content="1"
                                Foreground="Gray"
                                Style="{DynamicResource CaptionButtonStyleKey}"
                                Visibility="{Binding ElementName=MainWindowInstance, Path=WindowState, Converter={StaticResource WindowStateToVisibilityConverter}, ConverterParameter=最大化}">
                                <Button.ToolTip>
                                    <ToolTip FontFamily="メイリオ">
                                        <TextBlock
                                            Text="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Button_MaximizeWindow, Mode=OneWay}" />
                                    </ToolTip>
                                </Button.ToolTip>
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border
                                            x:Name="Border"
                                            Background="{TemplateBinding Background}"
                                            BorderThickness="1"
                                            CornerRadius="2"
                                            TextBlock.Foreground="{TemplateBinding Foreground}">
                                            <Border.BorderBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <LinearGradientBrush.GradientStops>
                                                        <GradientStopCollection>
                                                            <GradientStop Offset="0.0"
                                                                          Color="{StaticResource ControlBrightColor}" />
                                                            <GradientStop Offset="1.0"
                                                                          Color="{StaticResource ControlDarkerColor}" />
                                                        </GradientStopCollection>
                                                    </LinearGradientBrush.GradientStops>
                                                </LinearGradientBrush>
                                            </Border.BorderBrush>
                                            <ContentPresenter
                                                Margin="2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                RecognizesAccessKey="True" />
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualStateGroup.Transitions>
                                                        <VisualTransition GeneratedDuration="0:0:0.5" />
                                                        <VisualTransition GeneratedDuration="0" To="Pressed" />
                                                    </VisualStateGroup.Transitions>
                                                    <VisualState x:Name="Normal" />
                                                    <VisualState x:Name="MouseOver">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="Red" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Pressed">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="DarkRed" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[0].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderLightColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Disabled">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledControlDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledForegroundColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateManager.VisualStateGroups>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <Button
                                x:Name="RestoreButton"
                                Command="{x:Static SystemCommands.RestoreWindowCommand}"
                                Content="2"
                                Foreground="Gray"
                                Style="{DynamicResource CaptionButtonStyleKey}"
                                Visibility="{Binding ElementName=MainWindowInstance, Path=WindowState, Converter={StaticResource WindowStateToVisibilityConverter}, ConverterParameter=元に戻す}">
                                <Button.ToolTip>
                                    <ToolTip FontFamily="メイリオ">
                                        <TextBlock
                                            Text="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Button_Restore, Mode=OneWay}" />
                                    </ToolTip>
                                </Button.ToolTip>
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border
                                            x:Name="Border"
                                            Background="{TemplateBinding Background}"
                                            BorderThickness="1"
                                            CornerRadius="2"
                                            TextBlock.Foreground="{TemplateBinding Foreground}">
                                            <Border.BorderBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <LinearGradientBrush.GradientStops>
                                                        <GradientStopCollection>
                                                            <GradientStop Offset="0.0"
                                                                          Color="{StaticResource ControlBrightColor}" />
                                                            <GradientStop Offset="1.0"
                                                                          Color="{StaticResource ControlDarkerColor}" />
                                                        </GradientStopCollection>
                                                    </LinearGradientBrush.GradientStops>
                                                </LinearGradientBrush>
                                            </Border.BorderBrush>
                                            <ContentPresenter
                                                Margin="2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                RecognizesAccessKey="True" />
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualStateGroup.Transitions>
                                                        <VisualTransition GeneratedDuration="0:0:0.5" />
                                                        <VisualTransition GeneratedDuration="0" To="Pressed" />
                                                    </VisualStateGroup.Transitions>
                                                    <VisualState x:Name="Normal" />
                                                    <VisualState x:Name="MouseOver">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="Red" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Pressed">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="DarkRed" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[0].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderLightColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Disabled">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledControlDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledForegroundColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateManager.VisualStateGroups>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <Button
                                x:Name="CloseButton"
                                Command="{x:Static SystemCommands.CloseWindowCommand}"
                                Content="r"
                                Foreground="Gray"
                                Style="{DynamicResource CaptionButtonStyleKey}">
                                <Button.ToolTip>
                                    <ToolTip FontFamily="メイリオ">
                                        <TextBlock
                                            Text="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Button_Close, Mode=OneWay}" />
                                    </ToolTip>
                                </Button.ToolTip>
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border
                                            x:Name="Border"
                                            Background="{StaticResource ControlDarkerBackground}"
                                            BorderThickness="1"
                                            CornerRadius="2"
                                            TextBlock.Foreground="{TemplateBinding Foreground}">
                                            <Border.BorderBrush>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <LinearGradientBrush.GradientStops>
                                                        <GradientStopCollection>
                                                            <GradientStop Offset="0.0"
                                                                          Color="{StaticResource ControlBrightColor}" />
                                                            <GradientStop Offset="1.0"
                                                                          Color="{StaticResource ControlDarkerColor}" />
                                                        </GradientStopCollection>
                                                    </LinearGradientBrush.GradientStops>
                                                </LinearGradientBrush>
                                            </Border.BorderBrush>
                                            <ContentPresenter
                                                Margin="2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                RecognizesAccessKey="True" />
                                            <VisualStateManager.VisualStateGroups>
                                                <VisualStateGroup x:Name="CommonStates">
                                                    <VisualStateGroup.Transitions>
                                                        <VisualTransition GeneratedDuration="0:0:0.5" />
                                                        <VisualTransition GeneratedDuration="0" To="Pressed" />
                                                    </VisualStateGroup.Transitions>
                                                    <VisualState x:Name="Normal" />
                                                    <VisualState x:Name="MouseOver">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="Red" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Pressed">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0" Value="DarkRed" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[0].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource PressedBorderLightColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                    <VisualState x:Name="Disabled">
                                                        <Storyboard>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Background).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledControlDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledForegroundColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                            <ColorAnimationUsingKeyFrames
                                                                Storyboard.TargetName="Border"
                                                                Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                <EasingColorKeyFrame KeyTime="0"
                                                                    Value="{StaticResource DisabledBorderDarkColor}" />
                                                            </ColorAnimationUsingKeyFrames>
                                                        </Storyboard>
                                                    </VisualState>
                                                </VisualStateGroup>
                                            </VisualStateManager.VisualStateGroups>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                        <Button
                            Command="{Binding ShowVersionCommand}"
                            DockPanel.Dock="Right"
                            WindowChrome.IsHitTestVisibleInChrome="True">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <DockPanel>
                                        <Image
                                            Width="25"
                                            Height="25"
                                            Source="pack://application:,,,/Assets/img/square150x150logo_scale_200_Qpf_icon.ico" />
                                        <TextBlock
                                            Margin="5,0,0,0"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Center"
                                            Text="{Binding DataContext.Title.Value, ElementName=MainWindowInstance}" />
                                    </DockPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="SnapsToDevicePixels" Value="true" />
                                    <Setter Property="OverridesDefaultStyle" Value="true" />
                                    <Setter Property="FocusVisualStyle" Value="{StaticResource ButtonFocusVisual}" />
                                    <Setter Property="MinHeight" Value="23" />
                                    <Setter Property="MinWidth" Value="75" />
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border
                                                    x:Name="Border"
                                                    BorderThickness="1"
                                                    CornerRadius="2"
                                                    TextBlock.Foreground="{TemplateBinding Foreground}">
                                                    <Border.BorderBrush>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                            <LinearGradientBrush.GradientStops>
                                                                <GradientStopCollection>
                                                                    <GradientStop Offset="0.0"
                                                                        Color="{StaticResource ControlBrightColor}" />
                                                                    <GradientStop Offset="1.0"
                                                                        Color="{StaticResource ControlDarkerColor}" />
                                                                </GradientStopCollection>
                                                            </LinearGradientBrush.GradientStops>
                                                        </LinearGradientBrush>
                                                    </Border.BorderBrush>
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                                            <GradientStop Offset="0.0"
                                                                          Color="{StaticResource ControlBrightColor}" />
                                                            <GradientStop Offset="1.0"
                                                                          Color="{StaticResource ControlDarkerColor}" />
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                    <ContentPresenter
                                                        Margin="2"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        RecognizesAccessKey="True" />
                                                    <VisualStateManager.VisualStateGroups>
                                                        <VisualStateGroup x:Name="CommonStates">
                                                            <VisualStateGroup.Transitions>
                                                                <VisualTransition GeneratedDuration="0:0:0.5" />
                                                                <VisualTransition GeneratedDuration="0" To="Pressed" />
                                                            </VisualStateGroup.Transitions>
                                                            <VisualState x:Name="Normal" />
                                                            <VisualState x:Name="MouseOver">
                                                                <Storyboard>
                                                                    <ColorAnimationUsingKeyFrames
                                                                        Storyboard.TargetName="Border"
                                                                        Storyboard.TargetProperty="(Panel.Background).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                        <EasingColorKeyFrame KeyTime="0"
                                                                            Value="SkyBlue" />
                                                                    </ColorAnimationUsingKeyFrames>
                                                                </Storyboard>
                                                            </VisualState>
                                                            <VisualState x:Name="Pressed">
                                                                <Storyboard>
                                                                    <ColorAnimationUsingKeyFrames
                                                                        Storyboard.TargetName="Border"
                                                                        Storyboard.TargetProperty="(Panel.Background).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                        <EasingColorKeyFrame KeyTime="0"
                                                                            Value="DeepSkyBlue" />
                                                                    </ColorAnimationUsingKeyFrames>
                                                                    <ColorAnimationUsingKeyFrames
                                                                        Storyboard.TargetName="Border"
                                                                        Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[0].(GradientStop.Color)">
                                                                        <EasingColorKeyFrame KeyTime="0"
                                                                            Value="{StaticResource PressedBorderDarkColor}" />
                                                                    </ColorAnimationUsingKeyFrames>
                                                                    <ColorAnimationUsingKeyFrames
                                                                        Storyboard.TargetName="Border"
                                                                        Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                        <EasingColorKeyFrame KeyTime="0"
                                                                            Value="{StaticResource PressedBorderLightColor}" />
                                                                    </ColorAnimationUsingKeyFrames>
                                                                </Storyboard>
                                                            </VisualState>
                                                            <VisualState x:Name="Disabled">
                                                                <Storyboard>
                                                                    <ColorAnimationUsingKeyFrames
                                                                        Storyboard.TargetName="Border"
                                                                        Storyboard.TargetProperty="(Panel.Background).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                        <EasingColorKeyFrame KeyTime="0"
                                                                            Value="{StaticResource DisabledControlDarkColor}" />
                                                                    </ColorAnimationUsingKeyFrames>
                                                                    <ColorAnimationUsingKeyFrames
                                                                        Storyboard.TargetName="Border"
                                                                        Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)">
                                                                        <EasingColorKeyFrame KeyTime="0"
                                                                            Value="{StaticResource DisabledForegroundColor}" />
                                                                    </ColorAnimationUsingKeyFrames>
                                                                    <ColorAnimationUsingKeyFrames
                                                                        Storyboard.TargetName="Border"
                                                                        Storyboard.TargetProperty="(Border.BorderBrush).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                                        <EasingColorKeyFrame KeyTime="0"
                                                                            Value="{StaticResource DisabledBorderDarkColor}" />
                                                                    </ColorAnimationUsingKeyFrames>
                                                                </Storyboard>
                                                            </VisualState>
                                                        </VisualStateGroup>
                                                    </VisualStateManager.VisualStateGroups>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                        <TextBlock
                            Margin="0,0,10,0"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            DockPanel.Dock="Right"
                            Text="{Binding DiagramViewModel.FileName.Value}" />
                        <Grid />
                    </DockPanel>
                    <Grid Grid.Row="1">
                        <ContentPresenter HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />
                    </Grid>
                </Grid>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="WindowState" Value="Maximized">
                    <Setter TargetName="border" Property="BorderThickness" Value="8" />
                </Trigger>
                <Trigger Property="WindowState" Value="Normal">
                    <Setter TargetName="border" Property="BorderThickness" Value="1" />
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </Window.Template>
    <DockPanel>
        <ToolBarTray DockPanel.Dock="Top" Orientation="Horizontal">
            <ToolBarTray.Resources>
                <Style TargetType="{x:Type Button}">
                    <Setter Property="Margin" Value="2" />
                </Style>
            </ToolBarTray.Resources>
            <ToolBar>
                <StackPanel Orientation="Horizontal">
                    <Button
                        x:Name="Setting"
                        AutomationProperties.AutomationId="Setting"
                        Command="{Binding DiagramViewModel.SettingCommand}"
                        ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_Setting, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_Gear_Dark}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_Gear_Dark}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_Gear_Dark}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button
                        x:Name="Load"
                        AutomationProperties.AutomationId="Load"
                        Command="{Binding DiagramViewModel.LoadCommand}"
                        ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_Load, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_Load}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_Load}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_Load}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button
                        x:Name="Overwrite"
                        AutomationProperties.AutomationId="Overwrite"
                        Command="{Binding DiagramViewModel.OverwriteCommand}"
                        ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_Overwrite, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_Save}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_Save}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_Save}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button
                        x:Name="Export"
                        AutomationProperties.AutomationId="Export"
                        Command="{Binding DiagramViewModel.ExportCommand}"
                        ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_Export, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_Export_Dark}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_Export_Dark}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_Export_Dark}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </ToolBar>
            <ToolBar>
                <StackPanel Orientation="Horizontal">
                    <ComboBox
                        x:Name="EdgeThicknessComboBox"
                        Width="155"
                        Height="25"
                        Padding="0"
                        AutomationProperties.AutomationId="EdgeThickness"
                        ItemsSource="{Binding EdgeThicknessOptions}"
                        SelectedValue="{Binding DiagramViewModel.EdgeThickness.Value}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="75" />
                                        <ColumnDefinition Width="50" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="25" />
                                    </Grid.RowDefinitions>
                                    <Line
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Stroke="{Binding DataContext.DiagramViewModel.EdgeBrush.Value, ElementName=EdgeThicknessComboBox}"
                                        StrokeThickness="{Binding}"
                                        X1="0"
                                        X2="75"
                                        Y1="15"
                                        Y2="15" />
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        VerticalAlignment="Center">
                                        <Label.Content>
                                            <TextBlock>
                                                <Run Text="{Binding Mode=OneWay}" />
                                                <Run Text="pt" />
                                            </TextBlock>
                                        </Label.Content>
                                    </Label>
                                </Grid>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <Button
                        x:Name="SelectEdgeColor"
                        AutomationProperties.AutomationId="SelectEdgeColor"
                        Command="{Binding SelectColorCommand}"
                        CommandParameter="{Binding DiagramViewModel}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Fill="White"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <Rectangle
                                        Width="16"
                                        Height="16"
                                        Margin="2"
                                        StrokeThickness="4">
                                        <Rectangle.Stroke>
                                            <VisualBrush
                                                Stretch="None"
                                                TileMode="Tile"
                                                Viewport="0,0,16,16"
                                                ViewportUnits="Absolute">
                                                <VisualBrush.Visual>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="8" />
                                                            <ColumnDefinition Width="8" />
                                                        </Grid.ColumnDefinitions>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="8" />
                                                            <RowDefinition Height="8" />
                                                        </Grid.RowDefinitions>
                                                        <Rectangle
                                                            Grid.Row="0"
                                                            Grid.Column="0"
                                                            Fill="#EEE" />
                                                        <Rectangle
                                                            Grid.Row="0"
                                                            Grid.Column="1"
                                                            Fill="#AAA" />
                                                        <Rectangle
                                                            Grid.Row="1"
                                                            Grid.Column="0"
                                                            Fill="#AAA" />
                                                        <Rectangle
                                                            Grid.Row="1"
                                                            Grid.Column="1"
                                                            Fill="#EEE" />
                                                    </Grid>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Rectangle.Stroke>
                                    </Rectangle>
                                    <Rectangle
                                        Width="16"
                                        Height="16"
                                        Margin="2"
                                        Fill="Transparent"
                                        Stroke="{Binding DiagramViewModel.EdgeBrush.Value}"
                                        StrokeThickness="4" />
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button
                        x:Name="SelectFillColor"
                        AutomationProperties.AutomationId="SelectFillColor"
                        Command="{Binding SelectFillColorCommand}"
                        CommandParameter="{Binding DiagramViewModel}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Fill="White"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <Rectangle
                                        Width="16"
                                        Height="16"
                                        Margin="2">
                                        <Rectangle.Fill>
                                            <VisualBrush
                                                Stretch="None"
                                                TileMode="Tile"
                                                Viewport="0,0,16,16"
                                                ViewportUnits="Absolute">
                                                <VisualBrush.Visual>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="8" />
                                                            <ColumnDefinition Width="8" />
                                                        </Grid.ColumnDefinitions>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="8" />
                                                            <RowDefinition Height="8" />
                                                        </Grid.RowDefinitions>
                                                        <Rectangle
                                                            Grid.Row="0"
                                                            Grid.Column="0"
                                                            Fill="#EEE" />
                                                        <Rectangle
                                                            Grid.Row="0"
                                                            Grid.Column="1"
                                                            Fill="#AAA" />
                                                        <Rectangle
                                                            Grid.Row="1"
                                                            Grid.Column="0"
                                                            Fill="#AAA" />
                                                        <Rectangle
                                                            Grid.Row="1"
                                                            Grid.Column="1"
                                                            Fill="#EEE" />
                                                    </Grid>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Rectangle.Fill>
                                    </Rectangle>
                                    <Rectangle
                                        Width="16"
                                        Height="16"
                                        Margin="2"
                                        Fill="{Binding DiagramViewModel.FillBrush.Value}" />
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </ToolBar>
            <ToolBar>
                <StackPanel Orientation="Horizontal">
                    <Button Command="{Binding DiagramViewModel.GroupCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_Group, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_Group}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_Group}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_Group}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.UngroupCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_Ungroup, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_Ungroup}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_Ungroup}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_Ungroup}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </ToolBar>
            <ToolBar>
                <StackPanel Orientation="Horizontal">
                    <Button Command="{Binding DiagramViewModel.BringForegroundCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_BringForeground, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_BringToFront}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_BringToFront}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_BringToFront}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.BringForwardCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_BringForward, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_BringForward}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_BringForward}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_BringForward}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.SendBackwardCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_SendBackward, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_SendBackward}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_SendBackward}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_SendBackward}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.SendBackgroundCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_SendBackground, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_SendToBack}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_SendToBack}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_SendToBack}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </ToolBar>
            <ToolBar>
                <StackPanel Orientation="Horizontal">
                    <Button Command="{Binding DiagramViewModel.AlignTopCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_AlignTop, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_AlignTop}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_AlignTop}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_AlignTop}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.AlignVerticalCenterCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_AlignVerticalCenter, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_AlignCenteredVertical}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_AlignCenteredVertical}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_AlignCenteredVertical}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.AlignBottomCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_AlignBottom, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_AlignBottom}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_AlignBottom}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_AlignBottom}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                    <Button Command="{Binding DiagramViewModel.AlignLeftCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_AlignLeft, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_AlignLeft}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_AlignLeft}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_AlignLeft}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.AlignHorizontalCenterCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_AlignHorizontalCenter, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_AlignCenteredHorizontal}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_AlignCenteredHorizontal}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_AlignCenteredHorizontal}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.AlignRightCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_AlignRight, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_AlignRight}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_AlignRight}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_AlignRight}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                    <Button Command="{Binding DiagramViewModel.DistributeHorizontalCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_DistributeHorizontal, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_DistributeHorizontal}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_DistributeHorizontal}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_DistributeHorizontal}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.DistributeVerticalCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_DistributeVertical, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_DistributeVertical}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_DistributeVertical}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_DistributeVertical}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </ToolBar>
            <ToolBar>
                <StackPanel Orientation="Horizontal">
                    <Button Command="{Binding DiagramViewModel.UniformWidthCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_UniformWidth, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_UniformWidth}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_UniformWidth}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_UniformWidth}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <Button Command="{Binding DiagramViewModel.UniformHeightCommand}"
                            ToolTip="{Binding Source={x:Static helper:ResourceService.Current}, Path=Resources.Command_UniformHeight, Mode=OneWay}">
                        <Button.Template>
                            <ControlTemplate TargetType="{x:Type Button}">
                                <Grid>
                                    <Rectangle
                                        Width="20"
                                        Height="20"
                                        Stroke="Black"
                                        StrokeThickness="1" />
                                    <ContentControl Width="16" Height="16">
                                        <ContentControl.Style>
                                            <Style TargetType="{x:Type ContentControl}">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="True">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image
                                                                    Width="16"
                                                                    Height="16"
                                                                    Source="{StaticResource Icon_UniformHeight}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                        Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType={x:Type Button}}}"
                                                        Value="False">
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Image Width="16" Height="16">
                                                                    <Image.Source>
                                                                        <FormatConvertedBitmap
                                                                            DestinationFormat="Gray32Float"
                                                                            Source="{StaticResource Icon_UniformHeight}" />
                                                                    </Image.Source>
                                                                    <Image.OpacityMask>
                                                                        <ImageBrush
                                                                            ImageSource="{StaticResource Icon_UniformHeight}" />
                                                                    </Image.OpacityMask>
                                                                </Image>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ContentControl.Style>
                                    </ContentControl>
                                </Grid>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </ToolBar>
        </ToolBarTray>

        <ToolBarTray DockPanel.Dock="Left" Orientation="Vertical">
            <ToolBar ItemsSource="{Binding ToolBarViewModel.ToolItems}">
                <ToolBar.ItemTemplate>
                    <DataTemplate>
                        <ToggleButton
                            Width="40"
                            Height="40"
                            Padding="3"
                            AutomationProperties.Name="{Binding Name.Value}"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            BorderThickness="0"
                            Command="{Binding Command}"
                            IsChecked="{Binding IsChecked}"
                            ToolTip="{Binding Tooltip.Value}">
                            <Image RenderOptions.BitmapScalingMode="HighQuality" Source="{Binding ImageUrl}" />
                        </ToggleButton>
                    </DataTemplate>
                </ToolBar.ItemTemplate>
            </ToolBar>
        </ToolBarTray>

        <StatusBar Background="{StaticResource ControlDarkerBackground}" DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Width="80" AutomationProperties.AutomationId="Coordinate">
                    <Run>(</Run>
                    <Run Text="{Binding DiagramViewModel.CurrentPoint.X, StringFormat=##0.##}" />
                    <Run xml:space="preserve" Text=",&#x09;" />
                    <Run Text="{Binding DiagramViewModel.CurrentPoint.Y, StringFormat=##0.##}" />
                    <Run>)</Run>
                </TextBlock>
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <TextBlock
                    Width="100"
                    AutomationProperties.AutomationId="CurrentOperation"
                    TextAlignment="Center">
                    <Run Text="{Binding CurrentOperation.Value}" />
                </TextBlock>
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <TextBlock
                    Width="Auto"
                    AutomationProperties.AutomationId="Details"
                    TextAlignment="Left">
                    <Run Text="{Binding Details.Value}" />
                </TextBlock>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right" AutomationProperties.AutomationId="Message">
                <TextBlock Width="Auto" TextAlignment="Right">
                    <Run Text="{Binding Message.Value}" />
                </TextBlock>
            </StatusBarItem>
        </StatusBar>

        <!--  Diagram Control  -->
        <usercontrol:DiagramControl
            x:Name="DiagramControl"
            Margin="3,1,0,0"
            DataContext="{Binding DiagramViewModel}" />
    </DockPanel>
</Window>