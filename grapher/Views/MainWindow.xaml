<Window
    x:Class="grapher.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behavior="clr-namespace:grapher.Views.Behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:local="clr-namespace:grapher.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:prism="http://prismlibrary.com/"
    Title="GRAPHER"
    Width="800"
    Height="450"
    prism:ViewModelLocator.AutoWireViewModel="True"
    mc:Ignorable="d">
    <Window.Resources>
        <!--  リサイズハンドル用のテンプレート定義  -->
        <ControlTemplate x:Key="ResizeHandleTemplate" TargetType="Thumb">
            <Rectangle
                Width="7"
                Height="7"
                Margin="-3"
                Fill="White"
                Stroke="DimGray" />
        </ControlTemplate>

        <!--  装飾用のテンプレート定義  -->
        <ControlTemplate x:Key="AdornerTemplate">
            <Grid>
                <Thumb
                    Name="ResizeThumb_LT"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    DragDelta="ResizeThumb_DragDelta"
                    Template="{StaticResource ResizeHandleTemplate}" />
                <Thumb
                    Name="ResizeThumb_RT"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    DragDelta="ResizeThumb_DragDelta"
                    Template="{StaticResource ResizeHandleTemplate}" />
                <Thumb
                    Name="ResizeThumb_LB"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Bottom"
                    DragDelta="ResizeThumb_DragDelta"
                    Template="{StaticResource ResizeHandleTemplate}" />
                <Thumb
                    Name="ResizeThumb_RB"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    DragDelta="ResizeThumb_DragDelta"
                    Template="{StaticResource ResizeHandleTemplate}" />
            </Grid>
        </ControlTemplate>
    </Window.Resources>
    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File" />
        </Menu>
        <DockPanel DockPanel.Dock="Left">
            <ToolBarTray Orientation="Vertical">
                <ToolBar>
                    <ToggleButton>
                        <Image Source="pack://application:,,,/Assets/img/rectangle.png" />
                    </ToggleButton>
                </ToolBar>
            </ToolBarTray>
        </DockPanel>
        <ItemsControl ItemsSource="{Binding RenderItems}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas
                        AllowDrop="True"
                        Background="Transparent">
                        <i:Interaction.Behaviors>
                            <behavior:DragAcceptBehavior Description="{Binding Description}" />
                            <behavior:DeselectBehavior />
                        </i:Interaction.Behaviors>
                    </Canvas>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemContainerStyle>
                <Style TargetType="{x:Type ContentPresenter}">
                    <Setter Property="Canvas.Left" Value="{Binding X.Value}" />
                    <Setter Property="Canvas.Top" Value="{Binding Y.Value}" />
                </Style>
            </ItemsControl.ItemContainerStyle>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Rectangle
                        Width="{Binding Width.Value}"
                        Height="{Binding Height.Value}"
                        Fill="{Binding Fill.Value}"
                        Stroke="{Binding Stroke.Value}">
                        <i:Interaction.Behaviors>
                            <behavior:DragStartBehavior AllowedEffects="Move" DragDropData="{Binding}" />
                            <behavior:SelectBehavior />
                        </i:Interaction.Behaviors>
                        <Rectangle.Style>
                            <Style TargetType="{x:Type Rectangle}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected.Value}" Value="True">
                                        <Setter Property="local:AdornedBy.Template" Value="{StaticResource AdornerTemplate}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Rectangle.Style>
                    </Rectangle>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </DockPanel>
</Window>
